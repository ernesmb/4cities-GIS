<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Ernesto MartÃ­nez Becerra">
  <link rel="canonical" href="https://ernesmb.github.io/4cities-GIS/l_line/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>The closing of the L line and NYC demographics - 4cities GIS course</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "The closing of the L line and NYC demographics";
    var mkdocs_page_input_path = "l_line.md";
    var mkdocs_page_url = "/4cities-GIS/l_line/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> 4cities GIS course</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Hello</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../01_intro/">Intro to GIS</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../02_carto/">CARTO office</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../03_qgis/">QGIS I</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../04_qgis/">QGIS II</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../05_cloud/">Cloud GIS</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../06_geodb/">Geospatial databases</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../07_webmaps/">Webmapping</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">4cities GIS course</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>The closing of the L line and NYC demographics</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/ernesmb/4cities-GIS/edit/master/docs/l_line.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="the-closing-of-the-l-line-and-nyc-demographics">The closing of the L line and NYC demographics</h1>
<p>We will need the following datasets for this exercise:</p>
<ul>
<li><a href="https://builder-demo.carto.com/api/v2/sql?q=SELECT+*+FROM+subway_nycstations_l&amp;format=gpkg&amp;filename=subway_nycstations_l">New York subway stations</a>: <code>subway_nycstations_l</code>. </li>
<li><a href="https://builder-demo.carto.com/api/v2/sql?q=SELECT+*+FROM+nyc_subway_lines&amp;format=gpkg&amp;filename=nyc_subway_lines">New York subway lines</a>: <code>nyc_subway_lines</code>.</li>
<li><a href="https://builder-demo.carto.com/api/v2/sql?q=SELECT+*+FROM+nyc_block_group_census&amp;format=csv&amp;filename=nyc_block_group_census">New York block group census</a>: <code>nyc_block_group_census</code>.</li>
</ul>
<h3 id="1-create-a-map">1. Create a map <a name="map"></a></h3>
<ul>
<li>Click on <strong><code>NEW MAP</code></strong>.</li>
<li>Click on <strong><code>CONNECT DATASET</code></strong>.</li>
<li>Drag and drop <code>subway_nycstations_l.gpkg</code>.</li>
<li>Click on <strong><code>CONNECT DATASET</code></strong>.</li>
<li>Click on <code>Don't show me this again</code> to avoid modals.</li>
<li>You can rename the map title as "The L line and demographics" by double-clicking on it.</li>
</ul>
<p><img alt="map" src="../img/l_line/map.png" /></p>
<hr>

<h3 id="2-layers">2. Layers <a name="layers"></a></h3>
<ul>
<li>Add new layers:</li>
<li>Click on <strong><code>ADD</code></strong>.</li>
<li>Clik on <strong><code>UPLOAD</code></strong>.</li>
<li>Find <code>nyc_subway_lines.gpkg</code> on your computre and click on <strong><code>UPLOAD DATASET</code></strong>.</li>
<li>Click on <strong><code>ADD LAYER</code></strong>.</li>
<li>
<p>Reapeat the same for <code>nyc_block_group_census.csv</code></p>
</li>
<li>
<p>Now, by moving the layers using drag and drop we can change the order in which the layers are being displayed. We move <code>subway_nycstations_l</code> to the top and <code>nyc_subway_lines</code> in the second position. The layer <code>nyc_block_group_census</code> woudl stay at the bottom of the map.</p>
</li>
</ul>
<p><img alt="layers_ordered" src="../img/l_line/layers_ordered.png" /></p>
<ul>
<li>Click on one of the layers to show its components:</li>
<li><strong><code>DATA</code> tab</strong>: an overview of your table schema, from here you can also add widgets. If you want to have a look at your dataset, click the Data View icon, located on the bottom right of Builder when a map layer is selected.</li>
</ul>
<p><img alt="table" src="../img/l_line/table.png" /></p>
<p>Take a look at the letter and number the layers card has (<code>A</code>, <code>B</code> or <code>C</code>). This would be very useful for adding widgets and analysis. Depending on the order in which you added your data, your layer letters could be different than the screenshots. In this example, subway stations were layer A, subway lines layer B, and block groups layer C.</p>
<p><img alt="layer" src="../img/l_line/layer.png" /></p>
<hr>

<h3 id="3-analysis">3. Analysis <a name="analysis"></a></h3>
<h4 id="31-filter-by-column-value">3.1 Filter by column value</h4>
<ul>
<li>Go to the edit pane.</li>
<li>Click layer <code>nyc_subway_lines</code> and then select the <code>Analysis</code> tab. Finally, click on the <strong><code>ADD ANALYSIS</code></strong> button in order to add the analysis.</li>
<li>Select <strong><code>Filter by column value</code></strong> analysis.</li>
<li>Click on <strong><code>ADD ANALYSIS</code></strong>.</li>
<li>Set the parameters as follows:</li>
<li><code>TARGET COLUMN</code>: <code>route_id</code>.</li>
<li><code>VALUE</code>: <code>L</code>.</li>
<li><code>RESULTS</code>: <code>show</code>.</li>
<li>Now click on <strong><code>APPLY</code></strong> to see the result of the filtering. This is the L subway line.</li>
</ul>
<p><img alt="filter" src="../img/l_line/filter_column.png" /></p>
<hr>

<h4 id="32-create-traveldistance-buffer-analysis">3.2 Create Travel/Distance buffer analysis</h4>
<ul>
<li>We will apply this analysis to the layer <code>subway_nycstations_l</code>. Go back to the <strong>LAYERS</strong> pane in Builder's interface and click on <strong><code>0 ANALYSES</code></strong> under subway_nycstations_l. Click on <strong><code>ANALYSIS</code></strong>, then on <strong><code>ADD ANALYSIS</code></strong>.</li>
<li>Select the <em>Create Travel/Distance buffer</em> analysis. Click <strong><code>ADD ANALYSIS</code></strong>.</li>
<li>In the <strong>ANALYSIS</strong> tab of the layer, we have three sections:</li>
<li><em>Your workflow</em>: Since this is the first analysis we're adding to the <code>subway_nycstations_l</code> layer, node <em>A</em>, the analysis layer will be named node <em>A1</em>.</li>
<li><em>Create areas of influence</em>:<ul>
<li><em>BASE LAYER</em>: Should be the layer <code>subway_nycstations_l</code>, node <em>A</em> (<em>A0</em>).</li>
<li><em>TYPE</em>: Distance</li>
<li><em>UNIT</em>: mi</li>
<li><em>RADIUS</em>: 1</li>
<li><em>TRACKS</em>: 1</li>
<li><em>BOUNDARIES</em>: Intact</li>
</ul>
</li>
<li>After clicking <em>APPLY</em>, we should see this result: an area of influence of 1 mile around each subway station.</li>
</ul>
<p><img alt="aoi" src="../img/l_line/aoi.png" /></p>
<h4 id="33-intersect-and-aggregate-analysis">3.3 Intersect and Aggregate analysis</h4>
<ul>
<li>Go to the edit pane.</li>
<li>Click layer <code>nyc_block_group_census</code> and then select the <code>Analysis</code> tab. Finally, click on the <code>ADD ANALYSIS</code> button in order to add the analysis.</li>
<li>Select <strong><code>Intersect and aggregate</code></strong> analysis.</li>
<li>In the <em>ANALYIS</em> tab of the layer, we have three sections:</li>
<li><em>Your workflow</em>: Since this is the first analysis we're adding to the <code>nyc_block_group_census</code> layer, node <em>C</em>, this analysis layer will be named node <em>C1</em>.</li>
<li><em>Aggregate intersection</em>:<ul>
<li><em>Base Layer</em>: By default the base layer would be <code>nyc_block_group_census</code>.</li>
<li><em>Target Layer</em>: select the result layer of the Area of Influence analysis <em>A1</em></li>
</ul>
</li>
<li>After clicking <em>APPLY</em>, we should see this result:</li>
</ul>
<p><img alt="intersect" src="../img/l_line/intersect.png" /></p>
<h4 id="34-extract-source-node-and-reorder-layers">3.4 Extract source node and reorder layers</h4>
<p>Since we used our subway station layer as the input for the buffers analysis, the data appears as polygons. We want the buffers to be underneath the subway lines, and to extract the original subway station points for display.</p>
<ul>
<li>From the <code>subway_stations_l</code> layer, drag out the buffers sublayer and place it under the <code>nyc_subway_lines</code> layer</li>
<li>This will create a new layer <em>D</em>, and you will see the subway stations drawn on top of the AOI and block group layers</li>
</ul>
<p><img alt="new_layer" src="../img/l_line/new_layer.png" /></p>
<h3 id="4-styling">4. Styling <a name="styling"></a></h3>
<ul>
<li>
<p>Go to the edit pane, click on the <code>AOI</code> layer <em>D</em> and select the <code>STYLE</code> tab. Set the <code>Fill</code> color to a grey with high opacity, and make the stroke grey also.</p>
</li>
<li>
<p>Go to the edit pane, click on the <code>nyc_block_group_census</code> layer <em>D</em> and select the <code>STYLE</code> tab. Set the <code>Fill</code> color to a grey that blends with the basemap layer.</p>
</li>
</ul>
<p><img alt="style" src="../img/l_line/style.png" /></p>
<h3 id="5-widgets">5. Widgets <a name="widgets"></a></h3>
<ul>
<li>Go to the edit pane and click on the <code>widgets</code> tab.</li>
<li>Click on <code>ADD WIDGET</code> button.</li>
<li>Under the <code>CATEGORY</code> tab, click on the check box of variables <code>stop_name</code> and <code>ethnic_1st</code></li>
<li>Under the 'HISTOGRAM' tab, click on the check box of variables <code>median_household_income</code> and <code>median_age</code></li>
<li>Under the 'FORMULA' tab, click on the check box of variable <code>total_pop</code>.</li>
<li>Click on <code>CONTINUE</code></li>
</ul>
<p><br></p>
<p><img alt="widgets" src="../img/l_line/widgets.png" /></p>
<hr>

<h4 id="51-explore-and-style-data-with-widgets">5.1 Explore and style data with Widgets</h4>
<ul>
<li>Click on the tear drop icon inside each widget to see the Auto-style feature.</li>
<li>Filter the data by interacting with the category and histogram widgets.</li>
</ul>
<p><img alt="widget_filter" src="../img/l_line/widget_filter.png" /></p>
<h4 id="52-customize-widgets">5.2 Customize widgets</h4>
<ul>
<li>Reorder widgets: From <code>WIDGET</code> tab, drag and drop them into your preferred order.</li>
<li>Rename widgets: From <code>WIDGET</code> tab, rename each widget by clicking on its three blue dots and selecting the option to <code>Rename</code>.</li>
<li>Formula widget calculation:</li>
<li>By default, the formula widget is calculating the average population. However, we want to see the sum of the total population within our map view.</li>
<li>Click on the three blue dots in the Total Population widget and select the option to 'Edit'</li>
<li>In the <code>OPERATION</code> parameter, select <code>sum</code>.</li>
</ul>
<p><img alt="custom_widget" src="../img/l_line/custom_widget.png" />  </p>
<h3 id="6-publish">6. Publish <a name="publish"></a></h3>
<ul>
<li>Click on <strong><code>SHARE</code></strong>.</li>
<li>Set the map's privacy to <code>LINK</code> or <code>PUBLIC</code>.</li>
<li>Click on <strong><code>PUBLISH</code></strong>.</li>
<li>Now you can share the map:</li>
<li>Link: https://team.carto.com/u/builder-demo/builder/144826d6-0982-11e7-bdeb-0e233c30368f/embed</li>
<li>iframe: <code>&lt;iframe width="100%" height="520" frameborder="0" src="https://team.carto.com/u/builder-demo/builder/144826d6-0982-11e7-bdeb-0e233c30368f/embed" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen&gt;&lt;/iframe&gt;</code></li>
</ul>
<blockquote>
<p>Remember to update your map every time you make a change. To see those changes refresh your embed, or the web page where your map is hosted.</p>
</blockquote>
<hr>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/ernesmb/4cities-GIS/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
